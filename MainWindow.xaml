<Window x:Class="DollOverlay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DollOverlay"
        mc:Ignorable="d"
        Title="Table Overlay"
        AllowsTransparency="True"
        WindowStyle="None"
        Topmost="True" 
        Icon="images/favicon.ico"
        ShowInTaskbar="False"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        WindowStartupLocation="Manual">

    <WindowChrome.WindowChrome>
        <WindowChrome ResizeBorderThickness="8" 
                    CaptionHeight="0"
                    CornerRadius="0"
                    GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#1f1f1f"/>
            <Setter Property="BorderBrush" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <Style TargetType="PasswordBox">
            <Setter Property="Background" Value="#1f1f1f"/>
            <Setter Property="BorderBrush" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <Style x:Key="LoginButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="0,5"/>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <SolidColorBrush x:Key="ScrollBarTrackBrush" Color="Transparent"/>
        <SolidColorBrush x:Key="ScrollBarThumbNormalBrush" Color="#5a5a5a"/>
        <SolidColorBrush x:Key="ScrollBarThumbHoverBrush" Color="#888888"/>
        <SolidColorBrush x:Key="ScrollBarThumbPressedBrush" Color="#a0a0a0"/>
        <SolidColorBrush x:Key="ScrollBarButtonBrush" Color="Transparent"/>

        <Style x:Key="ScrollBarThumbStyle" TargetType="{x:Type Thumb}">
            <Setter Property="OverridesDefaultStyle" Value="true"/>
            <Setter Property="IsTabStop" Value="false"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Border x:Name="border"
                                Background="{StaticResource ScrollBarThumbNormalBrush}"
                                CornerRadius="4"
                                SnapsToDevicePixels="True"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ScrollBarThumbHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="true">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ScrollBarThumbPressedBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ScrollBarPageButton" TargetType="{x:Type RepeatButton}">
            <Setter Property="OverridesDefaultStyle" Value="true"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="IsTabStop" Value="false"/>
            <Setter Property="Focusable" Value="false"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type RepeatButton}">
                        <Border Background="Transparent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <ControlTemplate x:Key="VerticalScrollBarTemplate" TargetType="{x:Type ScrollBar}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Border Grid.RowSpan="3"
                        Background="{StaticResource ScrollBarTrackBrush}"
                        CornerRadius="4"/>
                <Track x:Name="PART_Track" Grid.Row="1" IsDirectionReversed="true">
                    <Track.DecreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}"/>
                    </Track.DecreaseRepeatButton>
                    <Track.Thumb>
                        <Thumb Style="{StaticResource ScrollBarThumbStyle}" Margin="1"/>
                    </Track.Thumb>
                    <Track.IncreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}"/>
                    </Track.IncreaseRepeatButton>
                </Track>
            </Grid>
        </ControlTemplate>

        <Style x:Key="{x:Type ScrollBar}" TargetType="{x:Type ScrollBar}">
            <Setter Property="OverridesDefaultStyle" Value="true"/>
            <Style.Triggers>
                <Trigger Property="Orientation" Value="Vertical">
                    <Setter Property="Width" Value="8"/>
                    <Setter Property="Template" Value="{StaticResource VerticalScrollBarTemplate}"/>
                </Trigger>
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:InvertBooleanConverter x:Key="InvertBooleanConverter" />
        <local:WhiteTimeColorConverter x:Key="WhiteTimeColorConverter"/>
    </Window.Resources>

    <Window.Background>
        <SolidColorBrush Opacity="0.01" Color="White"/>
    </Window.Background>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="8,0,8,8" VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel x:Name="TimeButtonsPanel"
                        Grid.Column="0"
                        Orientation="Horizontal"
                        HorizontalAlignment="Left"
                        Visibility="{Binding ElementName=MainContent, Path=Visibility}">
                
                <Button Content="15" Margin="3,0" Tag="15" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White"/>
                <Button Content="30" Margin="3,0" Tag="30" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="45" Margin="3,0" Tag="45" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="60" Margin="3,0" Tag="60" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="75" Margin="3,0" Tag="75" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="90" Margin="3,0" Tag="90" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="120" Margin="3,0" Tag="120" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="250" Margin="3,0" Tag="250" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
                <Button Content="350" Margin="3,0" Tag="350" Click="TimeButton_Click" FontSize="13" FontWeight="Bold" Background="Transparent" BorderThickness="0" BorderBrush="Transparent" Foreground="White" />
            </StackPanel>

            <Button x:Name="LogoutButton"
                    Grid.Column="1"
                    Content="Выйти" 
                    Width="60" 
                    Height="30" 
                    Background="Transparent" 
                    BorderThickness="0"
                    BorderBrush="Transparent"
                    Foreground="White" 
                    FontSize="16"
                    FontWeight="Bold" 
                    Click="LogoutButton_Click" 
                    Margin="0"
                    Visibility="{Binding ElementName=TablesPanel, Path=Visibility}"/>

            <Button x:Name="BackButton"
                    Grid.Column="2"
                    Content="←" 
                    Width="30" 
                    Height="30" 
                    Background="Transparent" 
                    BorderThickness="0"
                    BorderBrush="Transparent"
                    Foreground="White" 
                    FontWeight="Bold" 
                    Click="BackButton_Click" 
                    Margin="0"
                    Visibility="{Binding ElementName=MainContent, Path=Visibility}"/>

            <Button x:Name="CloseButton" 
                    Grid.Column="3"
                    Content="х" 
                    Width="30" 
                    Height="30" 
                    Background="Transparent" 
                    BorderThickness="0"
                    BorderBrush="Transparent"
                    Foreground="White" 
                    FontWeight="Bold" 
                    Click="CloseButton_Click" 
                    Margin="0"/>
        </Grid>
        
        <StackPanel x:Name="LoginPanel" HorizontalAlignment="Center" VerticalAlignment="Center" Background="#061b3d" Height="300" Width="300" Margin="0,30,0,0">
            <StackPanel x:Name="EmailLoginPanel" Visibility="Visible">
                <Label Content="Email:" FontSize="14" HorizontalAlignment="Center" Foreground="White" FontWeight="Bold" Margin="0,10,0,0"/>
                <TextBox x:Name="EmailTextBox" FontSize="14" Width="200" Margin="0,2,0,10" Foreground="White" Background="#7a8ebf"/>
                <Label Content="Пароль:" FontSize="14" HorizontalAlignment="Center" Foreground="White" FontWeight="Bold"/>
                <PasswordBox x:Name="PasswordBox" FontSize="14" Width="200" Margin="0,2,0,10" Foreground="White" Background="#7a8ebf"/>
                <Button x:Name="LoginButton" FontSize="14" Content="Войти" Click="LoginButton_Click" Width="100" Margin="0,5,0,5" FontWeight="Bold" Background="#1f70f2" Foreground="White" BorderThickness="0" Padding="20,5"/>
                <Button Content="Вход по токену" FontSize="14" Click="SwitchToTokenLogin" Width="150" Margin="0,5,0,5" FontWeight="Bold" Foreground="White" Background="Transparent" BorderThickness="0"/>
            </StackPanel>

            <StackPanel x:Name="TokenLoginPanel" Visibility="Collapsed">
                <Label Content="Вставьте ваш токен:" FontSize="14" HorizontalAlignment="Center" Foreground="White" FontWeight="Bold" Margin="0,10,0,0"/>
                <TextBox x:Name="TokenTextBox" FontSize="14" Foreground="White" Background="#7a8ebf" Width="200" Margin="0,2,0,10"/>
                <Button Content="Войти" FontSize="14" Click="TokenLoginButton_Click" Width="100" Margin="0,5,0,5" FontWeight="Bold" Background="#1f70f2" Foreground="White" BorderThickness="0" Padding="20,5"/>
                <Button Content="Вход по паролю" FontSize="14" Click="SwitchToEmailLogin" Width="150" Margin="0,5,0,5" FontWeight="Bold" Foreground="White" Background="Transparent" BorderThickness="0"/>
            </StackPanel>

            <TextBlock x:Name="StatusTextBlock" Margin="0,10,0,0" TextAlignment="Center" 
                           FontWeight="Bold" FontSize="14" Foreground="#eac988" Width="250" Height="60" TextWrapping="WrapWithOverflow"/>
        </StackPanel>

        <Grid x:Name="TablesPanel" Grid.Row="1" Visibility="Collapsed" Margin="8,0,8,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DataGrid x:Name="TablesDataGrid" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True"
                      Background="#3a3a3a" 
                      Foreground="White" 
                      RowBackground="#803a3a3a" 
                      FontSize="16"
                      AlternatingRowBackground="#80444444" 
                      HeadersVisibility="Column" 
                      GridLinesVisibility="Horizontal" 
                      HorizontalGridLinesBrush="#80555555" 
                      VerticalGridLinesBrush="#80555555"
                      CanUserSortColumns="False"
                      PreviewMouseLeftButtonDown="TablesDataGrid_PreviewMouseLeftButtonDown">
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Название таблицы" Binding="{Binding tableName}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <Grid x:Name="MainContent" Grid.Row="1" Visibility="Collapsed" Margin="8,0,8,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <DataGrid x:Name="CastlesDataGrid" AutoGenerateColumns="False" IsReadOnly="True" RowHeight="30"
                          Background="Transparent" FontSize="16" Foreground="White" RowBackground="Transparent" AlternatingRowBackground="#80444444" 
                          CanUserAddRows="False" CanUserDeleteRows="False" CanUserReorderColumns="False"
                          HeadersVisibility="Column" GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#80555555" VerticalGridLinesBrush="#80555555"
                          CanUserSortColumns="False">
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding WhiteTime}" Value="-">
                                    <Setter Property="Foreground" Value="LightSlateGray" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding WhiteTime}" Value="N/A">
                                    <Setter Property="Foreground" Value="LightSlateGray" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="" Width="30">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding StatusColor}" 
                                            Width="20" Height="20" 
                                            CornerRadius="3"
                                            HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Название" Binding="{Binding nameRu}" Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="FontWeight" Value="Bold" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding WhiteTime}" Value="-">
                                            <Setter Property="FontWeight" Value="Normal" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding WhiteTime}" Value="N/A">
                                            <Setter Property="FontWeight" Value="Normal" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="Через" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding WhiteTime}" FontWeight="Bold"
                                                VerticalAlignment="Center" HorizontalAlignment="Left">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="FontWeight" Value="Bold" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding WhiteTime}" Value="-">
                                                        <Setter Property="FontWeight" Value="Normal" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding WhiteTime}" Value="N/A">
                                                        <Setter Property="FontWeight" Value="Normal" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="СВ" Binding="{Binding fillingSpheretime}" Width="50"/>
                    </DataGrid.Columns>
                </DataGrid>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>